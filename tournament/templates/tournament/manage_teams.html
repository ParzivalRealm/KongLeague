{% extends 'tournament/base.html' %}

{% block title %}Gestionar Equipos - KongLeague{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex items-center justify-between">
        <h1 class="text-4xl font-bold text-kong-gold flex items-center">
            <span class="mr-3">ü¶ç</span> Gestionar Equipos
        </h1>
        <a href="{% url 'dashboard' %}" class="text-gray-400 hover:text-kong-gold transition">
            ‚Üê Volver al Dashboard
        </a>
    </div>
</div>

<!-- Add Team Form -->
<div class="bg-kong-purple rounded-lg shadow-lg p-6 mb-8">
    <h2 class="text-2xl font-bold text-kong-gold mb-4">Agregar Nuevo Equipo</h2>
    <form method="post" enctype="multipart/form-data" class="space-y-4">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Nombre del Equipo *</label>
                <input
                    type="text"
                    name="name"
                    required
                    class="w-full px-4 py-2 bg-kong-dark border border-kong-gold/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-kong-gold"
                    placeholder="Ej: Los Monos Furiosos"
                >
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Capit√°n (opcional)</label>
                <input
                    type="text"
                    name="captain_name"
                    class="w-full px-4 py-2 bg-kong-dark border border-kong-gold/30 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-kong-gold"
                    placeholder="Nombre del capit√°n"
                >
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Logo (opcional)</label>
                <input
                    type="file"
                    name="logo"
                    accept="image/*"
                    class="w-full px-4 py-2 bg-kong-dark border border-kong-gold/30 rounded-lg text-white file:mr-4 file:py-1 file:px-4 file:rounded-lg file:border-0 file:bg-kong-gold file:text-kong-darker file:font-semibold hover:file:bg-yellow-600 focus:outline-none focus:border-kong-gold"
                >
            </div>
        </div>

        <button
            type="submit"
            class="bg-kong-gold hover:bg-yellow-600 text-kong-darker font-bold py-2 px-6 rounded-lg transition"
        >
            ‚ûï Agregar Equipo
        </button>
    </form>
</div>

<!-- Teams List -->
<div class="bg-kong-purple rounded-lg shadow-lg overflow-hidden">
    <div class="px-6 py-4 bg-kong-dark border-b border-kong-gold/20">
        <h2 class="text-2xl font-bold text-kong-gold">Equipos Registrados</h2>
    </div>
    <div class="p-6">
        {% if teams %}
        <div class="grid grid-cols-1 gap-4">
            {% for team in teams %}
            <div class="bg-kong-dark rounded-lg p-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full bg-kong-purple border-2 border-kong-gold flex items-center justify-center text-2xl">
                        {% if team.logo %}
                        <img src="{{ team.logo.url }}" alt="{{ team.name }}" class="w-full h-full rounded-full object-cover">
                        {% else %}
                        ü¶ç
                        {% endif %}
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-white">{{ team.name }}</h3>
                        {% if team.captain_name %}
                        <p class="text-sm text-gray-400">Capit√°n: {{ team.captain_name }}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <!-- Edit Button -->
                    <button
                        onclick="editTeam({{ team.id }}, '{{ team.name }}', '{{ team.captain_name|default:'' }}', {% if team.logo %}'{{ team.logo.url }}'{% else %}''{% endif %})"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition"
                    >
                        ‚úèÔ∏è Editar
                    </button>
                    <!-- Delete Button -->
                    <form method="post" onsubmit="return confirm('¬øEst√°s seguro de eliminar este equipo?');" class="inline">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="team_id" value="{{ team.id }}">
                        <button
                            type="submit"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition"
                        >
                            üóëÔ∏è Eliminar
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-center text-gray-400 py-8">No hay equipos registrados todav√≠a</p>
        {% endif %}
    </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-kong-purple rounded-lg shadow-lg p-6 max-w-md w-full mx-4">
        <h3 class="text-2xl font-bold text-kong-gold mb-4">Editar Equipo</h3>
        <form method="post" enctype="multipart/form-data" id="editForm">
            {% csrf_token %}
            <input type="hidden" name="action" value="edit">
            <input type="hidden" name="team_id" id="edit_team_id">

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Nombre del Equipo</label>
                    <input
                        type="text"
                        name="name"
                        id="edit_name"
                        required
                        class="w-full px-4 py-2 bg-kong-dark border border-kong-gold/30 rounded-lg text-white focus:outline-none focus:border-kong-gold"
                    >
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Capit√°n</label>
                    <input
                        type="text"
                        name="captain_name"
                        id="edit_captain"
                        class="w-full px-4 py-2 bg-kong-dark border border-kong-gold/30 rounded-lg text-white focus:outline-none focus:border-kong-gold"
                    >
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Logo</label>
                    <!-- Current logo preview -->
                    <div id="current_logo_preview" class="mb-2 hidden">
                        <div class="flex items-center space-x-3">
                            <img id="edit_logo_preview" src="" alt="Logo actual" class="w-12 h-12 rounded-full object-cover border-2 border-kong-gold">
                            <label class="flex items-center text-sm text-gray-300 cursor-pointer">
                                <input type="checkbox" name="remove_logo" id="remove_logo" class="mr-2 rounded">
                                Eliminar logo
                            </label>
                        </div>
                    </div>
                    <input
                        type="file"
                        name="logo"
                        id="edit_logo"
                        accept="image/*"
                        class="w-full px-4 py-2 bg-kong-dark border border-kong-gold/30 rounded-lg text-white file:mr-4 file:py-1 file:px-4 file:rounded-lg file:border-0 file:bg-kong-gold file:text-kong-darker file:font-semibold hover:file:bg-yellow-600 focus:outline-none focus:border-kong-gold"
                    >
                    <p class="text-xs text-gray-400 mt-1">Deja vac√≠o para mantener el logo actual</p>
                </div>
            </div>

            <div class="flex space-x-3 mt-6">
                <button
                    type="submit"
                    class="flex-1 bg-kong-gold hover:bg-yellow-600 text-kong-darker font-bold py-2 px-4 rounded-lg transition"
                >
                    Guardar Cambios
                </button>
                <button
                    type="button"
                    onclick="closeEditModal()"
                    class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition"
                >
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function editTeam(id, name, captain, logo) {
    document.getElementById('edit_team_id').value = id;
    document.getElementById('edit_name').value = name;
    document.getElementById('edit_captain').value = captain || '';
    document.getElementById('edit_logo').value = '';
    document.getElementById('remove_logo').checked = false;

    // Handle logo preview
    const previewContainer = document.getElementById('current_logo_preview');
    const previewImg = document.getElementById('edit_logo_preview');

    if (logo) {
        previewImg.src = logo;
        previewContainer.classList.remove('hidden');
    } else {
        previewContainer.classList.add('hidden');
    }

    document.getElementById('editModal').classList.remove('hidden');
}

function closeEditModal() {
    document.getElementById('editModal').classList.add('hidden');
}
</script>
{% endblock %}
